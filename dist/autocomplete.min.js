var AutoComplete=function(){var e=function(e){this.element=e,this.stopListSuggestionRetrieve=!1;var c=this;this.element.addEventListener("keyup",function(e){var t,o,n,r=e.key|e.keyCode,l=e.target.parentNode.querySelectorAll(".autocomplete.dropdown ul li"),a=e.target.parentNode.querySelector(".autocomplete.dropdown ul li.selected"),s=function(e,t){for(var o=0;o<e.length;o++)if(e[o]===t)return o;return-1},i=function(e,t,o){var n=e[t],r=e[o];n&&(n.className=n.className.replace("selected","")),r&&(r.className+=" selected")};if("ArrowDown"===(n=r)||40===n)i(l,u=s(l,a),u+1),c.stopListSuggestionRetrieve=!0;else if("ArrowUp"===(o=r)||38===o){var u;i(l,u=s(l,a),u-1),c.stopListSuggestionRetrieve=!0}else("Enter"===(t=r)||13===t)&&(a.click(),c.stopListSuggestionRetrieve=!0)})};function s(e){return null==e||""==e}return e.prototype={loadConfiguration:function(){if(!1===this.element.dataset.autocomplete)return!1;var e=this.element.dataset.autocompletePostvarName,t=s(e)?"text":e,o=this.element.value,n=this.element.dataset["autocomplete-minlength"],r=s(n)?3:n,l=this.element.dataset.autocompleteSource;if(!s(l)){var a={};return a[t]=o,{data:a,source:l,minLength:r,text:o}}console.log("ERROR autocomplete-source is a required data attribute")},getSuggestionList:function(){if(this.stopListSuggestionRetrieve)this.stopListSuggestionRetrieve=!1;else{var o=this.loadConfiguration();if(o.text.length>=o.minLength){var n=this;!function(e,t,o,n,r){httpRequest=new XMLHttpRequest,httpRequest.open(t.toUpperCase(),e),httpRequest.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var l=function(e){var t=[];for(var o in e)e.hasOwnProperty(o)&&t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")}(o);httpRequest.onreadystatechange=function(){if(httpRequest.readyState===XMLHttpRequest.DONE){var e=JSON.parse(httpRequest.responseText);200===httpRequest.status?n(e):r(e)}},httpRequest.send(l)}(o.source,"POST",o.data,function(e){if(0<e.length){var t=n.createDropDown();n.populateDropDown(t,e,o.text)}else n.removeDropDown()},function(e){console.log(e),alert("ERROR autocomplete.js")})}else this.removeDropDown()}},createDropDown:function(){var e=this.element.parentNode.querySelector(".autocomplete.dropdown");if(s(e)){var t=document.createElement("div");t.setAttribute("tabindex","0"),t.setAttribute("class","autocomplete dropdown"),t.innerHTML="<ul></ul>",this.element.parentNode.appendChild(t),e=this.element.parentNode.querySelector(".autocomplete.dropdown")}e.querySelector("ul").innerHTML="";var o={left:this.element.offsetLeft,top:this.element.offsetTop},n=this.element.offsetHeight,r=this.element.offsetWidth;return e.style.width=r+"px",e.style.left=o.left,e.style.top=n+o.top+"px",e},populateDropDown:function(e,t,o){for(var n="",r=0;r<t.length;r++){var l=t[r],a=l.toLowerCase().indexOf(o.toLowerCase()),s=a+o.length,i=l.slice(0,a)+"<b>"+l.slice(a,s)+"</b>"+l.slice(s,l.length);n+='<li class="" data-value="'+l+'" tabindex="1">'+i+"</li>"}e.querySelector("ul").innerHTML+=n;var u=this.element,c=e.querySelectorAll("ul li");for(r=0;r<c.length;r++)c[r].onclick=function(){var e=this.dataset.value;u.value=e},c[r].onmouseover=function(e){var t=e.target,o=document.querySelectorAll(".autocomplete.dropdown ul li.selected");if(null!=o&&null!=o)for(var n=0;n<o.length;n++){var r=o[n];r.className=r.className.replace("selected","")}"li"==t.tagName.toLowerCase()?t.className+=" selected":t.parentNode.className+=" selected"},c[r].onmouseout=function(){var e=document.querySelectorAll(".autocomplete.dropdown ul li.selected");if(null!=e&&null!=e)for(var t=0;t<e.length;t++){var o=e[t];o.className=o.className.replace("selected","")}}},removeDropDown:function(){var e=this.element.parentNode,t=e.querySelector(".autocomplete.dropdown");s(t)||e.removeChild(t)}},e}();window.addEventListener("click",function(e){for(var t=document.querySelectorAll(".autocomplete.dropdown"),o=0;o<t.length;o++)t[o].parentNode.removeChild(t[o])});